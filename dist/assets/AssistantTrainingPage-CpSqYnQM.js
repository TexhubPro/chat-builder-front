import{f as Qs,a as Ys,j as s,l as Zs,n as se,r,s as ee,q as T,A as ae}from"./index-C_u4xdyz.js";import{u as te,a as Ts,D as ne,c as y,b as v,I as p,m as ys,d as vs,e as Ns}from"./DashboardLayout-DkkABKGa.js";import{a as ie,b as re,c as le,d as oe,e as ce,f as de,g as ue,h as ge}from"./assistantClient-C2wSUPvV.js";import{u as me,b as he,c as F,d}from"./usePageSeo-BxJ-yz3t.js";import{i as E}from"./chunk-SQIAVXJX-54KUZDaT.js";import{t as _s}from"./chunk-WEIB4WXA-DK_Uz93r.js";import{s as fe,l as I}from"./chunk-C3QHEOC2-B5FrEUze.js";import{s as V}from"./chunk-I3A4XRYQ-sVXV5hl3.js";import{c as Z}from"./chunk-EIRINNCE-uTIp6tVc.js";import{d as pe}from"./index-B4Fwgosg.js";import{m as ws}from"./chunk-5LXTSPS7-7t5Pyu1u.js";import{m as Ss}from"./chunk-R7OT77UN-DE55y1Ly.js";import"./useLabel-CzKtmXGX.js";import"./chunk-KQW2TNLT-twPLoLlr.js";import"./chunk-ICU6NNET-vKgoiDZU.js";import"./useListState-DfXDCfwh.js";import"./index-BDsjdhwy.js";import"./useToggleState-B-Q8VAk4.js";var Ls=Qs((c,o)=>{var f;const{as:e,className:x,children:O,...M}=c,_=e||"div",q=me(o),{slots:w,classNames:z}=te(),R=Ys(z?.header,x);return s.jsx(_,{ref:q,className:(f=w.header)==null?void 0:f.call(w,{class:R}),...M,children:O})});Ls.displayName="HeroUI.CardHeader";var Cs=Ls;function As(){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`}function xe(c,o){if(!c||c<=0)return o==="ru"?"0 Б":"0 B";const f=o==="ru"?["Б","КБ","МБ","ГБ"]:["B","KB","MB","GB"];let e=c,x=0;for(;e>=1024&&x<f.length-1;)e/=1024,x+=1;return`${e.toFixed(e>=100?0:1)} ${f[x]}`}function be(c){return c.map(o=>({trigger:o.trigger.trim(),response:o.response.trim()})).filter(o=>o.trigger!==""&&o.response!=="")}function je(c){return!c||c.length===0?[]:c.map(o=>({id:As(),trigger:o.trigger??"",response:o.response??""}))}function ke(){const{user:c,logout:o}=Zs(),{locale:f,messages:e}=se(),[x,O]=r.useState(!1),[M,_]=r.useState(!0),[q,w]=r.useState(!1),[z,R]=r.useState(!1),[Ds,ss]=r.useState(!1),[Fs,es]=r.useState(!1),[Is,as]=r.useState(null),[S,b]=r.useState([]),[P,C]=r.useState(null),[U,L]=r.useState(null),[ts,$]=r.useState(""),[ns,W]=r.useState(""),[is,G]=r.useState(""),[rs,H]=r.useState("polite"),[ls,K]=r.useState(!0),[os,X]=r.useState(!1),[Os,J]=r.useState(!1),[zs,Q]=r.useState(!1),[Y,N]=r.useState([]),[cs,l]=r.useState(null),[ds,u]=r.useState(null),[us,g]=r.useState(null),[gs,ms]=r.useState(""),[B,hs]=r.useState(null),{isOpen:Rs,onOpen:Ps,onOpenChange:Bs,onClose:fs}=Ts(),{isOpen:ks,onOpen:Es,onOpenChange:Vs,onClose:ps}=Ts(),k=r.useRef(null);he({title:`${e.assistantTraining.title} | ${e.app.name}`,description:e.assistantTraining.subtitle,locale:f});const m=r.useMemo(()=>S.find(a=>a.id===U)??null,[S,U]),Ms=async()=>{O(!0);try{await o()}finally{O(!1)}},qs=a=>{if(!a){$(""),W(""),G(""),H("polite"),K(!0),X(!1),J(!1),Q(!1),N([]);return}$(a.name??""),W(a.instructions??""),G(a.restrictions??""),H(a.conversation_tone??"polite"),K(!!a.enable_file_search),X(!!a.enable_file_analysis),J(!1),Q(!1),N(je(a.settings?.triggers))},j=(a,n)=>{if(a instanceof ae){if(a.status===401){l(e.assistantTraining.unauthorized);return}l(a.message);return}if(a instanceof Error){l(a.message);return}l(n)},xs=async()=>{const a=T();if(!a){l(e.assistantTraining.unauthorized),_(!1);return}_(!0),l(null);try{const n=await ie(a);b(n.assistants),C(n.limits),L(t=>t!==null&&n.assistants.some(i=>i.id===t)?t:null)}catch(n){j(n,e.assistantTraining.loadFailed)}finally{_(!1)}};r.useEffect(()=>{xs()},[]),r.useEffect(()=>{qs(m)},[m]);const Us=async a=>{if(a.preventDefault(),!m)return;const n=T();if(!n){l(e.assistantTraining.unauthorized);return}const t=ts.trim();if(t.length<2){l(e.assistantTraining.nameValidation);return}w(!0),l(null),u(null),g(null);try{const i=await re(n,m.id,{name:t,instructions:ns,restrictions:is,conversation_tone:rs,enable_file_search:ls,enable_file_analysis:os,enable_voice:!1,enable_web_search:!1,settings:{triggers:be(Y)}});b(h=>h.map(D=>D.id===i.assistant.id?i.assistant:D)),C(i.limits),u(e.assistantTraining.saveSuccess),i.warning&&g(i.warning)}catch(i){j(i,e.assistantTraining.saveFailed)}finally{w(!1)}},$s=async()=>{const a=T();if(!a){l(e.assistantTraining.unauthorized);return}const n=gs.trim();if(n.length<2){l(e.assistantTraining.nameValidation);return}R(!0),l(null),u(null),g(null);try{const t=await le(a,{name:n,conversation_tone:"polite",enable_file_search:!0,enable_file_analysis:!1,enable_voice:!1,enable_web_search:!1});b(i=>[t.assistant,...i]),C(t.limits),L(t.assistant.id),ms(""),u(e.assistantTraining.createSuccess),t.warning&&g(t.warning),fs()}catch(t){j(t,e.assistantTraining.createFailed)}finally{R(!1)}},Ws=async a=>{const n=T();if(!n){l(e.assistantTraining.unauthorized);return}as(a.id),l(null),u(null),g(null);try{const t=a.is_active?await oe(n,a.id):await ce(n,a.id);b(i=>i.map(h=>h.id===t.assistant.id?t.assistant:h)),C(t.limits),u(a.is_active?e.assistantTraining.stopSuccess:e.assistantTraining.startSuccess),t.warning&&g(t.warning)}catch(t){j(t,e.assistantTraining.actionFailed)}finally{as(null)}},Gs=async()=>{if(!B)return;const a=T();if(!a){l(e.assistantTraining.unauthorized);return}ss(!0),l(null),u(null),g(null);try{const n=await de(a,B);b(t=>t.filter(i=>i.id!==B)),C(n.limits),L(t=>t===B?null:t),u(e.assistantTraining.deleteSuccess),n.warning&&g(n.warning),hs(null),ps(),await xs()}catch(n){j(n,e.assistantTraining.actionFailed)}finally{ss(!1)}},Hs=async a=>{const n=Array.from(a.target.files??[]);if(!m||n.length===0)return;const t=T();if(!t){l(e.assistantTraining.unauthorized);return}es(!0),l(null),u(null),g(null);try{const i=await ue(t,m.id,n);b(h=>h.map(D=>D.id===i.assistant.id?i.assistant:D)),u(e.assistantTraining.filesUploadedSuccess),i.warning&&g(i.warning)}catch(i){j(i,e.assistantTraining.actionFailed)}finally{es(!1),k.current&&(k.current.value="")}},Ks=async a=>{if(!m)return;const n=T();if(!n){l(e.assistantTraining.unauthorized);return}l(null),u(null),g(null);try{const t=await ge(n,m.id,a);b(i=>i.map(h=>h.id===t.assistant.id?t.assistant:h)),u(e.assistantTraining.fileDeletedSuccess),t.warning&&g(t.warning)}catch(t){j(t,e.assistantTraining.actionFailed)}},bs=P?.can_create??!1,Xs=S.length,Js=P?.assistant_limit??0,js=m!==null,A={base:"h-auto min-h-0 flex-grow-0 items-center py-2 px-3",mainWrapper:"h-auto min-h-0 flex-grow-0 justify-start",title:"text-sm",description:"text-xs leading-5"};return s.jsxs(ne,{title:e.assistantTraining.title,user:c,onLogout:Ms,isLoggingOut:x,defaultSelectedKey:"assistant-training",children:[s.jsxs("div",{className:"space-y-4",children:[cs?s.jsx(F,{color:"danger",variant:"flat",classNames:A,title:e.assistantTraining.errorTitle,description:cs}):null,us?s.jsx(F,{color:"warning",variant:"flat",classNames:A,title:e.assistantTraining.warningTitle,description:us}):null,ds?s.jsx(F,{color:"success",variant:"flat",classNames:A,title:e.assistantTraining.successTitle,description:ds}):null,M?s.jsx(y,{shadow:"none",className:"border border-default-200 bg-white",children:s.jsx(v,{className:"flex min-h-[320px] items-center justify-center",children:s.jsx(ee,{label:e.assistantTraining.loading})})}):s.jsxs("div",{className:"grid grid-cols-1 gap-4 xl:grid-cols-[360px_minmax(0,1.1fr)]",children:[s.jsxs(y,{shadow:"none",className:`order-2 border border-default-200 bg-white ${js?"block":"hidden"} xl:block`,children:[s.jsxs(Cs,{className:"flex items-start justify-between gap-3 p-5 pb-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("h2",{className:"text-base font-semibold text-foreground sm:text-lg",children:e.assistantTraining.trainingTitle}),s.jsx("p",{className:"text-sm text-default-500",children:e.assistantTraining.subtitle})]}),s.jsx(d,{size:"sm",variant:"light",onPress:()=>L(null),startContent:s.jsx(p,{icon:"solar:alt-arrow-left-linear",width:16}),children:e.assistantTraining.backToAssistantsButton})]}),s.jsx(v,{className:"space-y-4 p-5 pt-0",children:m?s.jsxs("form",{className:"space-y-5",onSubmit:Us,children:[s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[s.jsx(E,{label:e.assistantTraining.nameLabel,value:ts,onValueChange:$,maxLength:120,isRequired:!0}),s.jsxs(fe,{label:e.assistantTraining.toneLabel,selectedKeys:[rs],onSelectionChange:a=>{const n=Array.from(a)[0];typeof n=="string"&&H(n)},children:[s.jsx(I,{children:e.assistantTraining.tonePolite},"polite"),s.jsx(I,{children:e.assistantTraining.toneFriendly},"friendly"),s.jsx(I,{children:e.assistantTraining.toneConcise},"concise"),s.jsx(I,{children:e.assistantTraining.toneFormal},"formal"),s.jsx(I,{children:e.assistantTraining.toneCustom},"custom")]})]}),s.jsx(_s,{label:e.assistantTraining.instructionsLabel,value:ns,onValueChange:W,minRows:5,maxLength:2e4}),s.jsx(_s,{label:e.assistantTraining.restrictionsLabel,value:is,onValueChange:G,minRows:4,maxLength:12e3}),s.jsx(y,{shadow:"none",className:"border border-default-200 bg-default-50",children:s.jsxs(v,{className:"space-y-4 p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:e.assistantTraining.settingsTitle}),s.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[s.jsx(V,{isSelected:ls,onValueChange:K,children:e.assistantTraining.fileSearchLabel}),s.jsx(V,{isSelected:os,onValueChange:X,children:e.assistantTraining.fileAnalysisLabel}),s.jsx(V,{isSelected:Os,isDisabled:!0,onValueChange:J,children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("span",{children:e.assistantTraining.voiceLabel}),s.jsx(Z,{size:"sm",variant:"flat",color:"warning",children:e.assistantTraining.comingSoonLabel})]})}),s.jsx(V,{isSelected:zs,isDisabled:!0,onValueChange:Q,children:s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("span",{children:e.assistantTraining.webSearchLabel}),s.jsx(Z,{size:"sm",variant:"flat",color:"warning",children:e.assistantTraining.comingSoonLabel})]})})]})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(y,{shadow:"none",className:"border border-default-200 bg-default-50",children:s.jsxs(v,{className:"space-y-3 p-4",children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:e.assistantTraining.triggersTitle}),s.jsx(d,{variant:"light",size:"sm",className:"px-3 text-xs text-primary",onPress:()=>N(a=>[...a,{id:As(),trigger:"",response:""}]),startContent:s.jsx(p,{icon:"solar:add-circle-linear",width:16}),children:e.assistantTraining.addTriggerButton})]}),Y.length===0?s.jsx("p",{className:"text-sm text-default-500",children:e.assistantTraining.noTriggers}):s.jsx("div",{className:"space-y-2",children:Y.map(a=>s.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-[minmax(0,1fr)_minmax(0,1fr)_2.5rem]",children:[s.jsx(E,{size:"sm",classNames:{inputWrapper:"h-10 min-h-10"},"aria-label":e.assistantTraining.triggerLabel,placeholder:e.assistantTraining.triggerLabel,value:a.trigger,onValueChange:n=>N(t=>t.map(i=>i.id===a.id?{...i,trigger:n}:i))}),s.jsx(E,{size:"sm",classNames:{inputWrapper:"h-10 min-h-10"},"aria-label":e.assistantTraining.triggerResponseLabel,placeholder:e.assistantTraining.triggerResponseLabel,value:a.response,onValueChange:n=>N(t=>t.map(i=>i.id===a.id?{...i,response:n}:i))}),s.jsx(d,{color:"danger",variant:"light",isIconOnly:!0,className:"h-10 min-h-10 w-10 self-stretch rounded-medium",onPress:()=>N(n=>n.filter(t=>t.id!==a.id)),"aria-label":e.assistantTraining.removeTriggerButton,children:s.jsx(p,{icon:"solar:trash-bin-trash-outline",width:18})})]},a.id))})]})}),s.jsx(y,{shadow:"none",className:"border border-default-200 bg-default-50",children:s.jsxs(v,{className:"space-y-3 p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-foreground",children:e.assistantTraining.filesTitle}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsx(d,{variant:"flat",color:"primary",size:"sm",onPress:()=>k.current?.click(),isLoading:Fs,startContent:s.jsx(p,{icon:"solar:upload-linear",width:16}),children:e.assistantTraining.uploadFilesButton}),s.jsx("span",{className:"text-xs text-default-500",children:"TXT, PDF, Word"}),s.jsx("input",{ref:k,type:"file",accept:".txt,.pdf,.doc,.docx,text/plain,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",className:"hidden",multiple:!0,onChange:Hs})]}),m.instruction_files.length===0?s.jsx("p",{className:"text-sm text-default-500",children:e.assistantTraining.noFiles}):s.jsx("div",{className:"space-y-2",children:m.instruction_files.map(a=>s.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-large border border-default-200 bg-white px-3 py-2",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:a.original_name}),s.jsx("p",{className:"text-xs text-default-500",children:xe(a.size,f)})]}),s.jsx(d,{color:"danger",variant:"light",isIconOnly:!0,size:"sm",onPress:()=>Ks(a.id),"aria-label":e.assistantTraining.deleteFileButton,children:s.jsx(p,{icon:"solar:trash-bin-trash-outline",width:18})})]},a.id))})]})})]}),s.jsx(d,{type:"submit",color:"primary",isLoading:q,children:e.assistantTraining.saveButton})]}):s.jsx("div",{className:"flex min-h-[260px] items-center justify-center rounded-large border border-dashed border-default-300 bg-default-50 p-6 text-center",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm font-semibold text-foreground",children:e.assistantTraining.selectAssistantTitle}),s.jsx("p",{className:"max-w-sm text-sm text-default-600",children:e.assistantTraining.selectAssistantHint})]})})})]}),s.jsxs(y,{shadow:"none",className:`order-1 border border-default-200 bg-white ${js?"hidden xl:block":"block"}`,children:[s.jsxs(Cs,{className:"flex items-start justify-between gap-3 p-5 pb-3",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("h2",{className:"text-base font-semibold text-foreground",children:e.assistantTraining.listTitle}),s.jsxs("p",{className:"text-xs text-default-500",children:[e.assistantTraining.limitLabel,": ",Xs,"/",Js]})]}),s.jsx(d,{size:"sm",color:"primary",onPress:Ps,isDisabled:!bs,startContent:s.jsx(p,{icon:"solar:add-circle-linear",width:16}),children:e.assistantTraining.createButton})]}),s.jsxs(v,{className:"space-y-3 p-5 pt-0",children:[P?.has_active_subscription?null:s.jsx(F,{color:"warning",variant:"flat",classNames:A,title:e.assistantTraining.inactiveSubscriptionTitle,description:e.assistantTraining.inactiveSubscriptionDescription}),!bs&&P?.has_active_subscription?s.jsx(F,{color:"danger",variant:"flat",classNames:A,title:e.assistantTraining.limitReachedTitle,description:e.assistantTraining.limitReachedDescription}):null,s.jsx(pe,{}),S.length===0?s.jsx("p",{className:"text-sm text-default-500",children:e.assistantTraining.noAssistants}):s.jsx("div",{className:"space-y-2",children:S.map(a=>s.jsx(y,{shadow:"none",className:`border ${a.id===U?"border-primary bg-primary/5":"border-default-200 bg-white"}`,children:s.jsxs(v,{className:"space-y-2 p-3",children:[s.jsxs("button",{type:"button",className:"w-full text-left",onClick:()=>L(a.id),children:[s.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:a.name}),s.jsxs("p",{className:"text-xs text-default-500",children:["ID: ",a.id]})]}),s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx(Z,{size:"sm",variant:"flat",color:a.is_active?"success":"default",children:a.is_active?e.assistantTraining.statusRunning:e.assistantTraining.statusStopped}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(d,{size:"sm",variant:"light",color:a.is_active?"warning":"success",onPress:()=>Ws(a),isLoading:Is===a.id,startContent:s.jsx(p,{icon:a.is_active?"solar:pause-circle-linear":"solar:play-circle-linear",width:16}),children:a.is_active?e.assistantTraining.stopButton:e.assistantTraining.startButton}),s.jsx(d,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>{hs(a.id),Es()},"aria-label":e.assistantTraining.deleteButton,children:s.jsx(p,{icon:"solar:trash-bin-trash-outline",width:16})})]})]})]})},a.id))})]})]})]})]}),s.jsx(ys,{isOpen:Rs,onOpenChange:Bs,children:s.jsxs(vs,{children:[s.jsx(Ss,{children:e.assistantTraining.createModalTitle}),s.jsx(Ns,{children:s.jsx(E,{label:e.assistantTraining.createModalNameLabel,value:gs,onValueChange:ms,placeholder:e.assistantTraining.createModalNamePlaceholder,maxLength:120})}),s.jsxs(ws,{children:[s.jsx(d,{variant:"light",onPress:fs,children:e.assistantTraining.createModalCancel}),s.jsx(d,{color:"primary",onPress:$s,isLoading:z,children:e.assistantTraining.createModalCreate})]})]})}),s.jsx(ys,{isOpen:ks,onOpenChange:Vs,children:s.jsxs(vs,{children:[s.jsx(Ss,{children:e.assistantTraining.deleteModalTitle}),s.jsx(Ns,{children:s.jsx("p",{className:"text-sm text-default-600",children:e.assistantTraining.deleteModalDescription})}),s.jsxs(ws,{children:[s.jsx(d,{variant:"light",onPress:ps,children:e.assistantTraining.deleteModalCancel}),s.jsx(d,{color:"danger",onPress:Gs,isLoading:Ds,children:e.assistantTraining.deleteModalConfirm})]})]})})]})}export{ke as default};
