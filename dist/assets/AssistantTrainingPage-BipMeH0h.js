import{f as Je,a as Qe,j as e,l as Ye,n as Ze,r,s as es,q as T,A as ss}from"./index-BKExW_na.js";import{u as as,a as ye,D as ts,c as y,b as v,I as p,m as ve,d as Ne,e as _e}from"./DashboardLayout-DDZNcain.js";import{a as ns,b as is,c as rs,d as ls,e as os,f as cs,g as ds,h as us}from"./assistantClient-CcA1aB3f.js";import{u as ms,b as gs,c as d}from"./usePageSeo-8KitHnL0.js";import{i as E}from"./chunk-SQIAVXJX-CJKqvBGK.js";import{t as we}from"./chunk-WEIB4WXA-BHDciMwJ.js";import{s as hs,l as D}from"./chunk-C3QHEOC2-DX-XTqVl.js";import{s as V}from"./chunk-I3A4XRYQ-DJ5kH-TN.js";import{d as fs}from"./index-zleLmW-F.js";import{c as ps}from"./chunk-EIRINNCE-DXQX58KB.js";import{m as Se}from"./chunk-5LXTSPS7-BNCUyN4Z.js";import{m as Ce}from"./chunk-R7OT77UN-DRNPAq56.js";import{a as I}from"./chunk-VF35X3H6-B4TsPbG8.js";import"./index-Dj2uZsLI.js";import"./useLabel-FUFqMuRp.js";import"./chunk-ICU6NNET-lVXZrmBV.js";import"./useListState-DDHPv_Kn.js";import"./index-D22UnKTq.js";import"./useToggleState-kTS7RoNn.js";var Ae=Je((c,o)=>{var f;const{as:s,className:x,children:O,...M}=c,_=s||"div",q=ms(o),{slots:w,classNames:z}=as(),B=Qe(z?.header,x);return e.jsx(_,{ref:q,className:(f=w.header)==null?void 0:f.call(w,{class:B}),...M,children:O})});Ae.displayName="HeroUI.CardHeader";var Le=Ae;function Fe(){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`}function xs(c,o){if(!c||c<=0)return o==="ru"?"0 Б":"0 B";const f=o==="ru"?["Б","КБ","МБ","ГБ"]:["B","KB","MB","GB"];let s=c,x=0;for(;s>=1024&&x<f.length-1;)s/=1024,x+=1;return`${s.toFixed(s>=100?0:1)} ${f[x]}`}function bs(c){return c.map(o=>({trigger:o.trigger.trim(),response:o.response.trim()})).filter(o=>o.trigger!==""&&o.response!=="")}function js(c){return!c||c.length===0?[]:c.map(o=>({id:Fe(),trigger:o.trigger??"",response:o.response??""}))}function Es(){const{user:c,logout:o}=Ye(),{locale:f,messages:s}=Ze(),[x,O]=r.useState(!1),[M,_]=r.useState(!0),[q,w]=r.useState(!1),[z,B]=r.useState(!1),[De,Z]=r.useState(!1),[Ie,ee]=r.useState(!1),[Oe,se]=r.useState(null),[S,b]=r.useState([]),[R,C]=r.useState(null),[U,L]=r.useState(null),[ae,$]=r.useState(""),[te,W]=r.useState(""),[ne,G]=r.useState(""),[ie,H]=r.useState("polite"),[re,K]=r.useState(!0),[le,X]=r.useState(!1),[oe,J]=r.useState(!1),[ce,Q]=r.useState(!1),[Y,N]=r.useState([]),[de,l]=r.useState(null),[ue,u]=r.useState(null),[me,m]=r.useState(null),[ge,he]=r.useState(""),[P,fe]=r.useState(null),{isOpen:ze,onOpen:Be,onOpenChange:Re,onClose:pe}=ye(),{isOpen:Pe,onOpen:ke,onOpenChange:Ee,onClose:xe}=ye(),k=r.useRef(null);gs({title:`${s.assistantTraining.title} | ${s.app.name}`,description:s.assistantTraining.subtitle,locale:f});const g=r.useMemo(()=>S.find(a=>a.id===U)??null,[S,U]),Ve=async()=>{O(!0);try{await o()}finally{O(!1)}},Me=a=>{if(!a){$(""),W(""),G(""),H("polite"),K(!0),X(!1),J(!1),Q(!1),N([]);return}$(a.name??""),W(a.instructions??""),G(a.restrictions??""),H(a.conversation_tone??"polite"),K(!!a.enable_file_search),X(!!a.enable_file_analysis),J(!!a.enable_voice),Q(!!a.enable_web_search),N(js(a.settings?.triggers))},j=(a,n)=>{if(a instanceof ss){if(a.status===401){l(s.assistantTraining.unauthorized);return}l(a.message);return}if(a instanceof Error){l(a.message);return}l(n)},be=async()=>{const a=T();if(!a){l(s.assistantTraining.unauthorized),_(!1);return}_(!0),l(null);try{const n=await ns(a);b(n.assistants),C(n.limits),L(t=>t!==null&&n.assistants.some(i=>i.id===t)?t:null)}catch(n){j(n,s.assistantTraining.loadFailed)}finally{_(!1)}};r.useEffect(()=>{be()},[]),r.useEffect(()=>{Me(g)},[g]);const qe=async a=>{if(a.preventDefault(),!g)return;const n=T();if(!n){l(s.assistantTraining.unauthorized);return}const t=ae.trim();if(t.length<2){l(s.assistantTraining.nameValidation);return}w(!0),l(null),u(null),m(null);try{const i=await is(n,g.id,{name:t,instructions:te,restrictions:ne,conversation_tone:ie,enable_file_search:re,enable_file_analysis:le,enable_voice:oe,enable_web_search:ce,settings:{triggers:bs(Y)}});b(h=>h.map(F=>F.id===i.assistant.id?i.assistant:F)),C(i.limits),u(s.assistantTraining.saveSuccess),i.warning&&m(i.warning)}catch(i){j(i,s.assistantTraining.saveFailed)}finally{w(!1)}},Ue=async()=>{const a=T();if(!a){l(s.assistantTraining.unauthorized);return}const n=ge.trim();if(n.length<2){l(s.assistantTraining.nameValidation);return}B(!0),l(null),u(null),m(null);try{const t=await rs(a,{name:n,conversation_tone:"polite",enable_file_search:!0,enable_file_analysis:!1,enable_voice:!1,enable_web_search:!1});b(i=>[t.assistant,...i]),C(t.limits),L(t.assistant.id),he(""),u(s.assistantTraining.createSuccess),t.warning&&m(t.warning),pe()}catch(t){j(t,s.assistantTraining.createFailed)}finally{B(!1)}},$e=async a=>{const n=T();if(!n){l(s.assistantTraining.unauthorized);return}se(a.id),l(null),u(null),m(null);try{const t=a.is_active?await ls(n,a.id):await os(n,a.id);b(i=>i.map(h=>h.id===t.assistant.id?t.assistant:h)),C(t.limits),u(a.is_active?s.assistantTraining.stopSuccess:s.assistantTraining.startSuccess),t.warning&&m(t.warning)}catch(t){j(t,s.assistantTraining.actionFailed)}finally{se(null)}},We=async()=>{if(!P)return;const a=T();if(!a){l(s.assistantTraining.unauthorized);return}Z(!0),l(null),u(null),m(null);try{const n=await cs(a,P);b(t=>t.filter(i=>i.id!==P)),C(n.limits),L(t=>t===P?null:t),u(s.assistantTraining.deleteSuccess),n.warning&&m(n.warning),fe(null),xe(),await be()}catch(n){j(n,s.assistantTraining.actionFailed)}finally{Z(!1)}},Ge=async a=>{const n=Array.from(a.target.files??[]);if(!g||n.length===0)return;const t=T();if(!t){l(s.assistantTraining.unauthorized);return}ee(!0),l(null),u(null),m(null);try{const i=await ds(t,g.id,n);b(h=>h.map(F=>F.id===i.assistant.id?i.assistant:F)),u(s.assistantTraining.filesUploadedSuccess),i.warning&&m(i.warning)}catch(i){j(i,s.assistantTraining.actionFailed)}finally{ee(!1),k.current&&(k.current.value="")}},He=async a=>{if(!g)return;const n=T();if(!n){l(s.assistantTraining.unauthorized);return}l(null),u(null),m(null);try{const t=await us(n,g.id,a);b(i=>i.map(h=>h.id===t.assistant.id?t.assistant:h)),u(s.assistantTraining.fileDeletedSuccess),t.warning&&m(t.warning)}catch(t){j(t,s.assistantTraining.actionFailed)}},je=R?.can_create??!1,Ke=S.length,Xe=R?.assistant_limit??0,Te=g!==null,A={base:"h-auto min-h-0 flex-grow-0 items-center py-2 px-3",mainWrapper:"h-auto min-h-0 flex-grow-0 justify-start",title:"text-sm",description:"text-xs leading-5"};return e.jsxs(ts,{title:s.assistantTraining.title,user:c,onLogout:Ve,isLoggingOut:x,defaultSelectedKey:"assistant-training",children:[e.jsxs("div",{className:"space-y-4",children:[de?e.jsx(I,{color:"danger",variant:"flat",classNames:A,title:s.assistantTraining.errorTitle,description:de}):null,me?e.jsx(I,{color:"warning",variant:"flat",classNames:A,title:s.assistantTraining.warningTitle,description:me}):null,ue?e.jsx(I,{color:"success",variant:"flat",classNames:A,title:s.assistantTraining.successTitle,description:ue}):null,M?e.jsx(y,{shadow:"none",className:"border border-default-200 bg-white",children:e.jsx(v,{className:"flex min-h-[320px] items-center justify-center",children:e.jsx(es,{label:s.assistantTraining.loading})})}):e.jsxs("div",{className:"grid grid-cols-1 gap-4 xl:grid-cols-[360px_minmax(0,1.1fr)]",children:[e.jsxs(y,{shadow:"none",className:`order-2 border border-default-200 bg-white ${Te?"block":"hidden"} xl:block`,children:[e.jsxs(Le,{className:"flex items-start justify-between gap-3 p-5 pb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground sm:text-lg",children:s.assistantTraining.trainingTitle}),e.jsx("p",{className:"text-sm text-default-500",children:s.assistantTraining.subtitle})]}),e.jsx(d,{size:"sm",variant:"light",onPress:()=>L(null),startContent:e.jsx(p,{icon:"solar:alt-arrow-left-linear",width:16}),children:s.assistantTraining.backToAssistantsButton})]}),e.jsx(v,{className:"space-y-4 p-5 pt-0",children:g?e.jsxs("form",{className:"space-y-5",onSubmit:qe,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(E,{label:s.assistantTraining.nameLabel,value:ae,onValueChange:$,maxLength:120,isRequired:!0}),e.jsxs(hs,{label:s.assistantTraining.toneLabel,selectedKeys:[ie],onSelectionChange:a=>{const n=Array.from(a)[0];typeof n=="string"&&H(n)},children:[e.jsx(D,{children:s.assistantTraining.tonePolite},"polite"),e.jsx(D,{children:s.assistantTraining.toneFriendly},"friendly"),e.jsx(D,{children:s.assistantTraining.toneConcise},"concise"),e.jsx(D,{children:s.assistantTraining.toneFormal},"formal"),e.jsx(D,{children:s.assistantTraining.toneCustom},"custom")]})]}),e.jsx(we,{label:s.assistantTraining.instructionsLabel,value:te,onValueChange:W,minRows:5,maxLength:2e4}),e.jsx(we,{label:s.assistantTraining.restrictionsLabel,value:ne,onValueChange:G,minRows:4,maxLength:12e3}),e.jsx(y,{shadow:"none",className:"border border-default-200 bg-default-50",children:e.jsxs(v,{className:"space-y-4 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:s.assistantTraining.settingsTitle}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx(V,{isSelected:re,onValueChange:K,children:s.assistantTraining.fileSearchLabel}),e.jsx(V,{isSelected:le,onValueChange:X,children:s.assistantTraining.fileAnalysisLabel}),e.jsx(V,{isSelected:oe,onValueChange:J,children:s.assistantTraining.voiceLabel}),e.jsx(V,{isSelected:ce,onValueChange:Q,children:s.assistantTraining.webSearchLabel})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{shadow:"none",className:"border border-default-200 bg-default-50",children:e.jsxs(v,{className:"space-y-3 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:s.assistantTraining.triggersTitle}),e.jsx(d,{variant:"light",size:"sm",className:"px-3 text-xs text-primary",onPress:()=>N(a=>[...a,{id:Fe(),trigger:"",response:""}]),startContent:e.jsx(p,{icon:"solar:add-circle-linear",width:16}),children:s.assistantTraining.addTriggerButton})]}),Y.length===0?e.jsx("p",{className:"text-sm text-default-500",children:s.assistantTraining.noTriggers}):e.jsx("div",{className:"space-y-2",children:Y.map(a=>e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-[minmax(0,1fr)_minmax(0,1fr)_2.5rem]",children:[e.jsx(E,{size:"sm",classNames:{inputWrapper:"h-10 min-h-10"},"aria-label":s.assistantTraining.triggerLabel,placeholder:s.assistantTraining.triggerLabel,value:a.trigger,onValueChange:n=>N(t=>t.map(i=>i.id===a.id?{...i,trigger:n}:i))}),e.jsx(E,{size:"sm",classNames:{inputWrapper:"h-10 min-h-10"},"aria-label":s.assistantTraining.triggerResponseLabel,placeholder:s.assistantTraining.triggerResponseLabel,value:a.response,onValueChange:n=>N(t=>t.map(i=>i.id===a.id?{...i,response:n}:i))}),e.jsx(d,{color:"danger",variant:"light",isIconOnly:!0,className:"h-10 min-h-10 w-10 self-stretch rounded-medium",onPress:()=>N(n=>n.filter(t=>t.id!==a.id)),"aria-label":s.assistantTraining.removeTriggerButton,children:e.jsx(p,{icon:"solar:trash-bin-trash-outline",width:18})})]},a.id))})]})}),e.jsx(y,{shadow:"none",className:"border border-default-200 bg-default-50",children:e.jsxs(v,{className:"space-y-3 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:s.assistantTraining.filesTitle}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(d,{variant:"flat",color:"primary",size:"sm",onPress:()=>k.current?.click(),isLoading:Ie,startContent:e.jsx(p,{icon:"solar:upload-linear",width:16}),children:s.assistantTraining.uploadFilesButton}),e.jsx("span",{className:"text-xs text-default-500",children:"TXT, PDF, Word"}),e.jsx("input",{ref:k,type:"file",accept:".txt,.pdf,.doc,.docx,text/plain,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",className:"hidden",multiple:!0,onChange:Ge})]}),g.instruction_files.length===0?e.jsx("p",{className:"text-sm text-default-500",children:s.assistantTraining.noFiles}):e.jsx("div",{className:"space-y-2",children:g.instruction_files.map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-large border border-default-200 bg-white px-3 py-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",children:a.original_name}),e.jsx("p",{className:"text-xs text-default-500",children:xs(a.size,f)})]}),e.jsx(d,{color:"danger",variant:"light",isIconOnly:!0,size:"sm",onPress:()=>He(a.id),"aria-label":s.assistantTraining.deleteFileButton,children:e.jsx(p,{icon:"solar:trash-bin-trash-outline",width:18})})]},a.id))})]})})]}),e.jsx(d,{type:"submit",color:"primary",isLoading:q,children:s.assistantTraining.saveButton})]}):e.jsx("div",{className:"flex min-h-[260px] items-center justify-center rounded-large border border-dashed border-default-300 bg-default-50 p-6 text-center",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s.assistantTraining.selectAssistantTitle}),e.jsx("p",{className:"max-w-sm text-sm text-default-600",children:s.assistantTraining.selectAssistantHint})]})})})]}),e.jsxs(y,{shadow:"none",className:`order-1 border border-default-200 bg-white ${Te?"hidden xl:block":"block"}`,children:[e.jsxs(Le,{className:"flex items-start justify-between gap-3 p-5 pb-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground",children:s.assistantTraining.listTitle}),e.jsxs("p",{className:"text-xs text-default-500",children:[s.assistantTraining.limitLabel,": ",Ke,"/",Xe]})]}),e.jsx(d,{size:"sm",color:"primary",onPress:Be,isDisabled:!je,startContent:e.jsx(p,{icon:"solar:add-circle-linear",width:16}),children:s.assistantTraining.createButton})]}),e.jsxs(v,{className:"space-y-3 p-5 pt-0",children:[R?.has_active_subscription?null:e.jsx(I,{color:"warning",variant:"flat",classNames:A,title:s.assistantTraining.inactiveSubscriptionTitle,description:s.assistantTraining.inactiveSubscriptionDescription}),!je&&R?.has_active_subscription?e.jsx(I,{color:"danger",variant:"flat",classNames:A,title:s.assistantTraining.limitReachedTitle,description:s.assistantTraining.limitReachedDescription}):null,e.jsx(fs,{}),S.length===0?e.jsx("p",{className:"text-sm text-default-500",children:s.assistantTraining.noAssistants}):e.jsx("div",{className:"space-y-2",children:S.map(a=>e.jsx(y,{shadow:"none",className:`border ${a.id===U?"border-primary bg-primary/5":"border-default-200 bg-white"}`,children:e.jsxs(v,{className:"space-y-2 p-3",children:[e.jsxs("button",{type:"button",className:"w-full text-left",onClick:()=>L(a.id),children:[e.jsx("p",{className:"truncate text-sm font-semibold text-foreground",children:a.name}),e.jsxs("p",{className:"text-xs text-default-500",children:["ID: ",a.id]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(ps,{size:"sm",variant:"flat",color:a.is_active?"success":"default",children:a.is_active?s.assistantTraining.statusRunning:s.assistantTraining.statusStopped}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{size:"sm",variant:"light",color:a.is_active?"warning":"success",onPress:()=>$e(a),isLoading:Oe===a.id,startContent:e.jsx(p,{icon:a.is_active?"solar:pause-circle-linear":"solar:play-circle-linear",width:16}),children:a.is_active?s.assistantTraining.stopButton:s.assistantTraining.startButton}),e.jsx(d,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>{fe(a.id),ke()},"aria-label":s.assistantTraining.deleteButton,children:e.jsx(p,{icon:"solar:trash-bin-trash-outline",width:16})})]})]})]})},a.id))})]})]})]})]}),e.jsx(ve,{isOpen:ze,onOpenChange:Re,children:e.jsxs(Ne,{children:[e.jsx(Ce,{children:s.assistantTraining.createModalTitle}),e.jsx(_e,{children:e.jsx(E,{label:s.assistantTraining.createModalNameLabel,value:ge,onValueChange:he,placeholder:s.assistantTraining.createModalNamePlaceholder,maxLength:120})}),e.jsxs(Se,{children:[e.jsx(d,{variant:"light",onPress:pe,children:s.assistantTraining.createModalCancel}),e.jsx(d,{color:"primary",onPress:Ue,isLoading:z,children:s.assistantTraining.createModalCreate})]})]})}),e.jsx(ve,{isOpen:Pe,onOpenChange:Ee,children:e.jsxs(Ne,{children:[e.jsx(Ce,{children:s.assistantTraining.deleteModalTitle}),e.jsx(_e,{children:e.jsx("p",{className:"text-sm text-default-600",children:s.assistantTraining.deleteModalDescription})}),e.jsxs(Se,{children:[e.jsx(d,{variant:"light",onPress:xe,children:s.assistantTraining.deleteModalCancel}),e.jsx(d,{color:"danger",onPress:We,isLoading:De,children:s.assistantTraining.deleteModalConfirm})]})]})})]})}export{Es as default};
