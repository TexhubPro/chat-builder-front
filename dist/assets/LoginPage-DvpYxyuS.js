import{g as D,h as U,l as W,n as Z,r as c,j as e,L as $,A as O,z as T}from"./index-EtEDBUvV.js";import{s as H,c as Q,d as J,g as P,i as K,l as X,b as v}from"./validation-Dr_-wTAJ.js";import{b as Y,B as M,L as ee,d as b,c as te}from"./usePageSeo-EE8mv1fT.js";import{i as F}from"./chunk-SQIAVXJX-B0Nmrhyk.js";import{c as ae}from"./chunk-PMMJMDBI-C-s7vqEG.js";import{d as I}from"./index-dtaVbuSp.js";import{l as se}from"./chunk-SIOPM2FD-BEwo82i6.js";import"./chunk-KQW2TNLT-tntXc0HU.js";import"./useLabel-00ET08Gj.js";import"./chunk-ICU6NNET-CqUNE2xV.js";import"./useToggleState-C7Htmiee.js";function z(a){return typeof a=="object"&&a!==null}function B(a){return z(a.data)?a.data:{}}function re(a){return typeof a.token=="string"&&z(a.user)}function ie(a){const f=B(a).errors;if(!f)return{};const u=l=>{const x=f[l];if(!Array.isArray(x))return;const o=x[0];return typeof o=="string"?o:void 0},p=u("login")??u("email")??u("phone"),t=u("password");return{...p?{login:p}:{},...t?{password:t}:{}}}function oe(){return e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("path",{fill:"#EA4335",d:"M12 10.2v3.9h5.5c-.2 1.3-1.7 3.9-5.5 3.9-3.3 0-6-2.7-6-6s2.7-6 6-6c1.9 0 3.2.8 3.9 1.5l2.7-2.6C16.9 3.2 14.7 2.2 12 2.2 6.8 2.2 2.5 6.5 2.5 11.7S6.8 21.2 12 21.2c6.9 0 9.1-4.8 9.1-7.2 0-.5 0-.8-.1-1.1H12Z"}),e.jsx("path",{fill:"#34A853",d:"M3.7 7.6l3.2 2.3C7.8 8 9.7 6.7 12 6.7c1.9 0 3.2.8 3.9 1.5l2.7-2.6C16.9 3.9 14.7 2.9 12 2.9 8.3 2.9 5.1 5 3.7 7.6Z"}),e.jsx("path",{fill:"#FBBC05",d:"M12 21.2c2.6 0 4.7-.8 6.3-2.3l-2.9-2.4c-.8.6-1.9 1.1-3.4 1.1-3.8 0-5.2-2.6-5.5-3.8l-3.2 2.5c1.5 2.9 4.6 4.9 8.7 4.9Z"}),e.jsx("path",{fill:"#4285F4",d:"M21.1 13.9c.1-.3.1-.6.1-1s0-.8-.1-1.2H12v3.9h5.5c-.3 1.4-1.2 2.5-2.2 3.3l2.9 2.4c1.7-1.6 2.9-4 2.9-7.4Z"})]})}function ne(){return e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{fill:"currentColor",d:"M12 .5C5.6.5.5 5.6.5 12c0 5.1 3.3 9.4 7.9 10.9.6.1.8-.2.8-.6v-2.2c-3.2.7-3.9-1.4-3.9-1.4-.5-1.3-1.2-1.7-1.2-1.7-1-.7.1-.7.1-.7 1 .1 1.6 1.1 1.6 1.1 1 .1 1.8 1.2 1.8 1.2.8 1.5 2.2 1.1 2.7.8.1-.6.3-1.1.6-1.3-2.5-.3-5.1-1.2-5.1-5.5 0-1.2.4-2.2 1.1-3-.1-.3-.5-1.4.1-2.9 0 0 .9-.3 3 .9a10.3 10.3 0 0 1 5.5 0c2.1-1.2 3-.9 3-.9.6 1.5.2 2.6.1 2.9.7.8 1.1 1.8 1.1 3 0 4.2-2.6 5.2-5.1 5.5.4.3.7 1 .7 2v3c0 .4.2.7.8.6A11.5 11.5 0 0 0 23.5 12C23.5 5.6 18.4.5 12 .5Z"})})}function je(){const a=D(),w=U(),{login:f,setSession:u}=W(),{locale:p,messages:t}=Z(),[l,x]=c.useState(""),[o,R]=c.useState(""),[L,_]=c.useState(!0),[k,y]=c.useState(!1),[E,N]=c.useState(null),[S,r]=c.useState(null),[d,i]=c.useState({}),j=w.state,q=j?.from&&j.from!=="/login"?j.from:"/";Y({title:`${t.auth.loginTitle} | ${t.app.name}`,description:t.auth.subtitle,locale:p});const V=async n=>{n.preventDefault(),r(null),i({});const s={};if(!l||!o){l||(s.login=t.auth.requiredCredentials),o||(s.password=t.auth.requiredCredentials),i(s);return}if(o.length<=6){i({password:t.auth.passwordTooShort});return}if(!Q(l)){i({login:t.auth.invalidLoginIdentifier});return}const m=J(l);y(!0),r(null),i({});try{await f({login:m,password:o,deviceName:L?`${P()}-remember`:P()}),a(q,{replace:!0})}catch(h){if(h instanceof O){const g=B(h);if(g.requires_moderation){if(re(g)){u(g.token,g.user),a("/moderation",{replace:!0});return}r(t.auth.accountUnderModeration);return}if(g.requires_email_verification){const G=K(m)?`?email=${encodeURIComponent(m)}`:"";a(`/verify-email${G}`,{replace:!0});return}const A=X(ie(h),t);if(Object.keys(A).length>0){i(A);return}r(v(h.message,t));return}if(h instanceof Error){r(v(h.message,t));return}r(t.auth.loginFailed)}finally{y(!1)}},C=async n=>{r(null),i({}),N(n);try{const m=(await T(n)).authorization_url;if(!m)throw new Error(t.auth.socialLoginFailed);window.location.assign(m)}catch(s){s instanceof Error?r(v(s.message,t)):r(t.auth.socialLoginFailed),N(null)}};return e.jsx("main",{className:"flex min-h-screen items-center justify-center bg-white px-4 py-8",children:e.jsxs("div",{className:"w-full max-w-72",children:[e.jsxs("header",{className:"mb-6 flex items-start justify-between gap-3",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("img",{src:M.logoUrl,alt:M.logoAlt,className:"h-10 w-10 rounded-md object-contain"})}),e.jsx(ee,{})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("h1",{className:"text-3xl font-bold leading-tight text-foreground",children:t.auth.welcomeBack}),e.jsx("p",{className:"mt-1 text-base text-default-600",children:t.auth.subtitle})]}),e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:V,noValidate:!0,children:[e.jsx(F,{isRequired:!0,autoComplete:"username",label:t.auth.loginLabel,labelPlacement:"outside",placeholder:t.auth.loginPlaceholder,value:l,onValueChange:n=>{x(H(n)),d.login&&i(s=>({...s,login:void 0}))},variant:"bordered",maxLength:255,inputMode:"email",isInvalid:!!d.login,errorMessage:d.login}),e.jsx(F,{isRequired:!0,autoComplete:"current-password",label:t.auth.passwordLabel,labelPlacement:"outside",placeholder:t.auth.passwordPlaceholder,type:"password",value:o,onValueChange:n=>{R(n),d.password&&i(s=>({...s,password:void 0}))},variant:"bordered",maxLength:255,isInvalid:!!d.password,errorMessage:d.password}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(ae,{isSelected:L,onValueChange:_,classNames:{label:"text-medium"},children:t.auth.rememberMe}),e.jsx(b,{type:"button",variant:"light",size:"md",className:"text-medium",onPress:()=>a("/forgot-password"),children:t.auth.forgotPassword})]}),S?e.jsx(te,{color:"danger",title:t.auth.errorTitle,description:S,variant:"flat"}):null,e.jsx(b,{type:"submit",color:"primary",isLoading:k,fullWidth:!0,children:t.auth.loginButton})]}),e.jsxs("div",{className:"my-4 flex items-center gap-3",children:[e.jsx(I,{className:"flex-1"}),e.jsx("span",{className:"text-small text-default-500",children:t.common.separatorOr}),e.jsx(I,{className:"flex-1"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(b,{variant:"bordered",startContent:e.jsx(oe,{}),isLoading:E==="google",onPress:()=>{C("google")},fullWidth:!0,children:t.auth.continueWithGoogle}),e.jsx(b,{variant:"bordered",startContent:e.jsx(ne,{}),isLoading:E==="github",onPress:()=>{C("github")},fullWidth:!0,children:t.auth.continueWithGithub})]}),e.jsxs("p",{className:"mt-4 text-center text-small text-default-500",children:[t.auth.noAccount," ",e.jsx(se,{as:$,to:"/register",size:"sm",children:t.auth.signUp})]})]})})}export{je as default};
