import{l as Y,n as Z,r as l,j as r,q as J,K as Q,A as ee}from"./index-C_u4xdyz.js";import{D as re,c as ae,b as se,h as te,I as D}from"./DashboardLayout-DkkABKGa.js";import{e as A,f as oe,h as ne,b as le}from"./validation-Dr_-wTAJ.js";import{b as ie,d as C,c as I}from"./usePageSeo-BxJ-yz3t.js";import{i as x}from"./chunk-SQIAVXJX-54KUZDaT.js";import{d as de}from"./index-B4Fwgosg.js";import"./useLabel-CzKtmXGX.js";import"./chunk-KQW2TNLT-twPLoLlr.js";import"./chunk-ICU6NNET-vKgoiDZU.js";const ce=4*1024*1024;function ue(a){return typeof a=="object"&&a!==null}function fe(a){return a.trim().toLowerCase().replace(/[.,!?]+/g,"").replace(/\s+/g," ")}function v(a,f){const u=fe(a),{messages:n}=f;return u==="profile updated successfully"?n.profile.profileUpdated:u==="current password is incorrect"?n.profile.currentPasswordInvalid:u==="the new password must be different from the current password"?n.profile.newPasswordDifferent:u.includes("file must be an image")||u.includes("must be an image")||u.includes("file of type")?n.profile.avatarInvalidType:u.includes("must not be greater than")?n.profile.avatarTooLarge:le(a,n)}function me(a,f){const n=(ue(a.data)?a.data:void 0)?.errors;if(!n)return{};const m=d=>{const y=n[d];if(!Array.isArray(y))return;const p=y[0];return typeof p=="string"?p:void 0},e=m("name"),g=m("avatar"),b=m("current_password"),h=m("new_password"),j=m("new_password_confirmation");return{...e?{name:v(e,f)}:{},...g?{avatar:v(g,f)}:{},...b?{currentPassword:v(b,f)}:{},...h?{newPassword:v(h,f)}:{},...j?{confirmPassword:v(j,f)}:{}}}function Se(){const{user:a,logout:f,refreshSession:u}=Y(),n=Z(),{locale:m,messages:e}=n,[g,b]=l.useState(a?.name??""),[h,j]=l.useState(""),[d,y]=l.useState(""),[p,_]=l.useState(""),[U,E]=l.useState(null),[S,T]=l.useState(null),[O,N]=l.useState(!1),[H,k]=l.useState(!1),[G,F]=l.useState(!1),[z,P]=l.useState(null),[M,L]=l.useState(null),[i,c]=l.useState({});ie({title:`${e.profile.title} | ${e.app.name}`,description:e.profile.subtitle,locale:m});const R=l.useRef(null);l.useEffect(()=>{b(a?.name??"")},[a?.name]),l.useEffect(()=>()=>{S&&URL.revokeObjectURL(S)},[S]);const q=O?null:S??a?.avatar??null,K=async()=>{F(!0);try{await f()}finally{F(!1)}},$=t=>{const o=t.target.files?.[0];if(o){if(!o.type.startsWith("image/")){c(s=>({...s,avatar:e.profile.avatarInvalidType}));return}if(o.size>ce){c(s=>({...s,avatar:e.profile.avatarTooLarge}));return}c(s=>({...s,avatar:void 0})),P(null),L(null),N(!1),E(o),T(s=>(s&&URL.revokeObjectURL(s),URL.createObjectURL(o))),t.target.value=""}},W=()=>{E(null),N(!0),c(t=>({...t,avatar:void 0})),P(null),L(null),T(t=>(t&&URL.revokeObjectURL(t),null)),R.current&&(R.current.value="")},X=async t=>{t.preventDefault(),c({}),P(null),L(null);const o=A(g),s={};if(o?o.length<2&&(s.name=e.profile.nameInvalid):s.name=e.profile.nameRequired,(h!==""||d!==""||p!=="")&&(h||(s.currentPassword=e.profile.currentPasswordRequired),d||(s.newPassword=e.profile.newPasswordRequired),p||(s.confirmPassword=e.profile.confirmPasswordRequired),d&&d.length<=6?s.newPassword=e.auth.passwordTooShort:d&&!ne(d)&&(s.newPassword=e.auth.weakPassword),d&&p&&d!==p&&(s.confirmPassword=e.auth.passwordMismatch)),Object.keys(s).length>0){c(s);return}const B=J();if(!B){P(e.auth.invalidCredentials);return}k(!0);try{const w=await Q(B,{name:o,avatarFile:U,removeAvatar:O&&!U,currentPassword:h||void 0,newPassword:d||void 0,newPasswordConfirmation:p||void 0});await u(),b(w.user.name),j(""),y(""),_(""),E(null),N(!1),L(v(w.message,n))}catch(w){if(w instanceof ee){const V=me(w,n);if(Object.keys(V).length>0){c(V);return}P(v(w.message,n));return}if(w instanceof Error){P(v(w.message,n));return}P(e.profile.updateFailed)}finally{k(!1)}};return r.jsx(re,{title:e.profile.title,user:a,onLogout:K,isLoggingOut:G,defaultSelectedKey:"",children:r.jsx(ae,{shadow:"none",className:"border border-default-200 bg-white",children:r.jsxs(se,{className:"space-y-6 p-4 sm:p-6",children:[r.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(te,{src:q??void 0,name:A(g)||a?.name||(m==="ru"?"Пользователь":"User"),className:"h-20 w-20 text-2xl"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-semibold text-foreground",children:A(g)||a?.name||(m==="ru"?"Пользователь":"User")}),r.jsx("p",{className:"text-sm text-default-500",children:e.profile.subtitle})]})]}),r.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row",children:[r.jsx("input",{ref:R,type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp,image/avif",className:"hidden",onChange:$}),r.jsx(C,{variant:"bordered",startContent:r.jsx(D,{icon:"solar:camera-add-linear",width:18}),onPress:()=>R.current?.click(),children:e.profile.uploadAvatar}),r.jsx(C,{variant:"light",color:"danger",startContent:r.jsx(D,{icon:"solar:trash-bin-trash-linear",width:18}),isDisabled:!q,onPress:W,children:e.profile.removeAvatar})]})]}),r.jsx("p",{className:"text-xs text-default-500",children:e.profile.avatarHint}),r.jsxs("form",{className:"space-y-6",onSubmit:X,noValidate:!0,children:[r.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[r.jsx(x,{isRequired:!0,label:e.profile.nameLabel,labelPlacement:"outside",placeholder:e.profile.namePlaceholder,value:g,onValueChange:t=>{b(oe(t)),i.name&&c(o=>({...o,name:void 0}))},variant:"bordered",maxLength:255,isInvalid:!!i.name,errorMessage:i.name}),r.jsx(x,{label:e.profile.emailLabel,labelPlacement:"outside",value:a?.email??"",variant:"bordered",isReadOnly:!0,description:e.profile.emailReadonlyHint}),r.jsx(x,{label:e.profile.phoneLabel,labelPlacement:"outside",value:a?.phone??e.profile.phoneNotSet,variant:"bordered",isReadOnly:!0,description:e.profile.phoneReadonlyHint})]}),i.avatar?r.jsx(I,{color:"danger",title:e.profile.errorTitle,description:i.avatar,variant:"flat"}):null,r.jsx(de,{}),r.jsxs("section",{className:"space-y-3",children:[r.jsx("h2",{className:"text-base font-semibold text-foreground",children:e.profile.passwordSectionTitle}),r.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[r.jsx(x,{autoComplete:"current-password",type:"password",label:e.profile.currentPasswordLabel,labelPlacement:"outside",placeholder:e.profile.currentPasswordPlaceholder,value:h,onValueChange:t=>{j(t),i.currentPassword&&c(o=>({...o,currentPassword:void 0}))},variant:"bordered",maxLength:255,isInvalid:!!i.currentPassword,errorMessage:i.currentPassword}),r.jsx(x,{autoComplete:"new-password",type:"password",label:e.profile.newPasswordLabel,labelPlacement:"outside",placeholder:e.profile.newPasswordPlaceholder,value:d,onValueChange:t=>{y(t),i.newPassword&&c(o=>({...o,newPassword:void 0}))},variant:"bordered",maxLength:255,isInvalid:!!i.newPassword,errorMessage:i.newPassword}),r.jsx(x,{autoComplete:"new-password",type:"password",label:e.profile.confirmPasswordLabel,labelPlacement:"outside",placeholder:e.profile.confirmPasswordPlaceholder,value:p,onValueChange:t=>{_(t),i.confirmPassword&&c(o=>({...o,confirmPassword:void 0}))},variant:"bordered",maxLength:255,isInvalid:!!i.confirmPassword,errorMessage:i.confirmPassword})]})]}),z?r.jsx(I,{color:"danger",title:e.profile.errorTitle,description:z,variant:"flat"}):null,M?r.jsx(I,{color:"success",title:e.profile.successTitle,description:M,variant:"flat"}):null,r.jsx("div",{className:"flex justify-end",children:r.jsx(C,{type:"submit",color:"primary",isLoading:H,children:e.profile.saveButton})})]})]})})})}export{Se as default};
