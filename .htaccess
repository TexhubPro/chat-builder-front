Options -Indexes

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Keep ACME challenge reachable for TLS issuance.
    RewriteRule ^\.well-known/ - [L]

    # If API is proxied separately, do not rewrite it here.
    RewriteRule ^api/ - [L]

    # When this repository root is used as DocumentRoot,
    # force frontend to be served from built /dist output.
    RewriteCond %{DOCUMENT_ROOT}/dist/index.html -f
    RewriteRule ^$ dist/index.html [L]
    RewriteCond %{DOCUMENT_ROOT}/dist/index.html -f
    RewriteRule ^index\.html$ dist/index.html [L]

    # Serve static files from /dist by requested path.
    RewriteCond %{DOCUMENT_ROOT}/dist/$1 -f [OR]
    RewriteCond %{DOCUMENT_ROOT}/dist/$1 -d
    RewriteRule ^(.*)$ dist/$1 [L]

    # Serve existing files/directories from current root (fallback/local use).
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # SPA fallback.
    RewriteCond %{DOCUMENT_ROOT}/dist/index.html -f
    RewriteRule ^ dist/index.html [L]
    RewriteRule ^ index.html [L]
</IfModule>

<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
